generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id    String @id @default(cuid())
  email String @unique
  name  String
  password String
  hasSubscription Boolean @default(false)
  aiAnalysisCount Int @default(0)
  lastAnalysisReset DateTime @default(now())
  transactions Transaction[]
  analyses Analysis[]
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum PaymentMethod {
  DINHEIRO
  PIX
  CREDITO
}

enum TransactionCategory {
  MORADIA       // Aluguel, hipoteca, manutenção
  CONTAS        // Luz, água, internet, gás, celular
  MERCADO       // Supermercado, feira, padaria
  COMIDA_FORA   // Restaurantes, delivery, lanches
  TRANSPORTE    // Combustível, transporte público, apps
  SAUDE         // Farmácia, médico, plano de saúde
  EDUCACAO      // Cursos, livros, mensalidades
  LAZER         // Streaming, cinema, hobbies, bares
  COMPRAS       // Roupas, eletrônicos, presentes
  DIVIDAS       // Pagamento de empréstimo, fatura do cartão
  INVESTIMENTOS // Aportes em fundos, ações, etc.
  SALARIO       // Receita principal
  OUTRAS_RECEITAS // Bônus, freelance, presentes recebidos
  OUTROS        // Qualquer outra coisa não categorizada
}

model Transaction {
  id            String              @id @default(cuid())
  description   String
  amount        Float
  type          TransactionType
  category      TransactionCategory
  paymentMethod PaymentMethod
  date          DateTime            @default(now())
  userId        String
  user          User                @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Analysis {
  id                  String   @id @default(cuid())
  userId              String
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  resumo              String   @db.Text
  pontoPositivo       String   @db.Text
  pontoDeAtencao      String   @db.Text
  analiseDePadroes    String[] 
  conselhos           String[] 
  planoDeEmergencia   String[] 
  createdAt           DateTime @default(now())
  
  @@index([userId, createdAt])
}